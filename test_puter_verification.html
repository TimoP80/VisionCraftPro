<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Puter.com Verification Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body class="flex items-center justify-center p-4">
    <div class="glass rounded-lg p-8 max-w-2xl w-full">
        <h1 class="text-3xl font-bold text-white mb-6 text-center">ğŸ§ª Puter.com Verification Test</h1>
        
        <div class="space-y-4">
            <!-- Status Display -->
            <div id="status" class="bg-black/50 rounded-lg p-4">
                <h2 class="text-xl font-semibold text-white mb-2">ğŸ“Š Status</h2>
                <div id="status-content" class="text-gray-300">
                    <p>ğŸ”„ Loading Puter.js...</p>
                </div>
            </div>

            <!-- Test Controls -->
            <div class="bg-black/50 rounded-lg p-4">
                <h2 class="text-xl font-semibold text-white mb-2">ğŸ§ª Test Controls</h2>
                <div class="space-y-3">
                    <input type="text" id="test-prompt" value="beautiful woman, high quality, detailed, photorealistic" 
                           class="w-full px-4 py-2 bg-gray-800 text-white rounded-lg border border-gray-600">
                    <button onclick="testPuterAPI()" 
                            class="w-full px-4 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-semibold transition-colors">
                        ğŸ†“ Test Puter.com Generation
                    </button>
                    <button onclick="checkPuterStatus()" 
                            class="w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold transition-colors">
                        ğŸ” Check Puter Status
                    </button>
                </div>
            </div>

            <!-- Results Display -->
            <div id="results" class="bg-black/50 rounded-lg p-4">
                <h2 class="text-xl font-semibold text-white mb-2">ğŸ“‹ Results</h2>
                <div id="results-content" class="text-gray-300">
                    <p>Click "Test Puter.com Generation" to see results...</p>
                </div>
            </div>

            <!-- Help Section -->
            <div class="bg-yellow-900/50 rounded-lg p-4 border border-yellow-600">
                <h3 class="text-lg font-semibold text-yellow-300 mb-2">ğŸ’¡ Troubleshooting</h3>
                <div class="text-yellow-200 text-sm space-y-1">
                    <p>â€¢ If you see "puter.ai is null", Puter.js needs email verification</p>
                    <p>â€¢ Visit <a href="https://puter.com" target="_blank" class="underline">puter.com</a> to verify email</p>
                    <p>â€¢ After verification, refresh this page</p>
                    <p>â€¢ Check browser console (F12) for detailed error messages</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸ†“ Puter.js - FREE Premium Image Generation -->
    <script src="https://js.puter.com/v2/"></script>
    
    <script>
        let puterStatus = {
            loaded: false,
            authenticated: false,
            error: null
        };

        // Check Puter.js status on load
        window.addEventListener('load', () => {
            setTimeout(checkPuterStatus, 1000); // Wait for Puter.js to load
        });

        function updateStatus(message, type = 'info') {
            const statusContent = document.getElementById('status-content');
            const colors = {
                'info': 'text-gray-300',
                'success': 'text-green-300',
                'error': 'text-red-300',
                'warning': 'text-yellow-300'
            };
            
            statusContent.innerHTML = `<p class="${colors[type]}">${message}</p>`;
        }

        function updateResults(message, type = 'info') {
            const resultsContent = document.getElementById('results-content');
            const colors = {
                'info': 'text-gray-300',
                'success': 'text-green-300',
                'error': 'text-red-300',
                'warning': 'text-yellow-300'
            };
            
            resultsContent.innerHTML = `<p class="${colors[type]}">${message}</p>`;
        }

        function checkPuterStatus() {
            console.log('ğŸ” Checking Puter.js status...');
            
            // Check if Puter.js loaded
            if (typeof puter === 'undefined') {
                updateStatus('âŒ Puter.js not loaded - check internet connection', 'error');
                return;
            }
            
            puterStatus.loaded = true;
            updateStatus('âœ… Puter.js loaded successfully', 'success');
            
            // Check if puter.ai is available
            if (!puter.ai) {
                updateStatus('âŒ puter.ai is null - email verification required', 'error');
                updateResults('ğŸ“§ Email verification required! Visit puter.com to verify your email, then refresh this page.', 'warning');
                return;
            }
            
            puterStatus.authenticated = true;
            updateStatus('âœ… Puter.ai available - ready for generation!', 'success');
            updateResults('ğŸ‰ Puter.com is ready! You can now generate images for FREE!', 'success');
        }

        async function testPuterAPI() {
            const prompt = document.getElementById('test-prompt').value;
            
            updateResults('ğŸ”„ Testing Puter.com generation...', 'info');
            
            try {
                // Check Puter status first
                if (!puterStatus.loaded) {
                    await checkPuterStatus();
                }
                
                if (!puterStatus.authenticated) {
                    updateResults('âŒ Puter.ai not available - verify email first', 'error');
                    return;
                }
                
                console.log('ğŸ¨ Starting Puter.com generation...');
                console.log('ğŸ“ Prompt:', prompt);
                
                const startTime = Date.now();
                
                // Test with DALL-E 3
                const imageElement = await puter.ai.txt2img(prompt, {
                    model: "dall-e-3",
                    quality: "standard"
                });
                
                const generationTime = (Date.now() - startTime) / 1000;
                
                console.log('âœ… Generation successful!', {
                    time: generationTime,
                    element: imageElement
                });
                
                // Display the image
                const resultsContent = document.getElementById('results-content');
                resultsContent.innerHTML = `
                    <div class="space-y-3">
                        <p class="text-green-300">âœ… Puter.com generation successful!</p>
                        <p class="text-gray-300">â±ï¸ Time: ${generationTime.toFixed(2)}s</p>
                        <p class="text-gray-300">ğŸ¨ Model: DALL-E 3</p>
                        <p class="text-gray-300">ğŸ“ Prompt: ${prompt}</p>
                        <div class="mt-3"></div>
                    </div>
                `;
                
                // Add the image to results
                const imageContainer = resultsContent.querySelector('.mt-3');
                imageContainer.appendChild(imageElement);
                imageElement.className = 'max-w-full rounded-lg border border-gray-600';
                
                updateStatus('âœ… Puter.com working perfectly!', 'success');
                
            } catch (error) {
                console.error('âŒ Puter.com generation failed:', error);
                
                let errorMessage = error.message;
                
                // Provide specific help for common errors
                if (errorMessage.includes('null') || errorMessage.includes('undefined')) {
                    errorMessage = 'puter.ai is null - email verification required. Visit puter.com to verify your email.';
                } else if (errorMessage.includes('network') || errorMessage.includes('fetch')) {
                    errorMessage = 'Network error - check internet connection and try again.';
                } else if (errorMessage.includes('quota') || errorMessage.includes('limit')) {
                    errorMessage = 'Rate limit reached - wait a moment and try again.';
                }
                
                updateResults(`âŒ Error: ${errorMessage}`, 'error');
                updateStatus('âŒ Puter.com test failed', 'error');
            }
        }

        // Auto-check status every 5 seconds
        setInterval(() => {
            if (puterStatus.loaded && !puterStatus.authenticated) {
                checkPuterStatus();
            }
        }, 5000);
    </script>
</body>
</html>
